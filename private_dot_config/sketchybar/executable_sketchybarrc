#!/bin/bash

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Colors (透明/グラス風)
BAR_COLOR=0x80000000        # 半透明黒
ITEM_BG=0x40ffffff          # 薄い白背景
ACCENT=0xff7aa2f7           # Tokyo Night blue (bordersと統一)
TEXT_COLOR=0xffffffff       # 白テキスト
INACTIVE=0x80ffffff         # 半透明白

##### Bar Appearance #####
sketchybar --bar \
  position=top \
  height=36 \
  blur_radius=50 \
  color=$BAR_COLOR \
  border_width=0 \
  shadow=on \
  sticky=on \
  topmost=off

##### Changing Defaults #####
default=(
  padding_left=8
  padding_right=8
  icon.font="Hack Nerd Font:Bold:16.0"
  label.font="Hack Nerd Font:Bold:13.0"
  icon.color=$TEXT_COLOR
  label.color=$TEXT_COLOR
  icon.padding_left=6
  icon.padding_right=4
  label.padding_left=4
  label.padding_right=6
  background.color=$ITEM_BG
  background.corner_radius=6
  background.height=26
)
sketchybar --default "${default[@]}"

##### AeroSpace Workspaces #####
# AeroSpaceイベントを追加
sketchybar --add event aerospace_workspace_change

# ワークスペース1-10を追加（動的に表示/非表示）
for sid in 1 2 3 4 5 6 7 8 9 10; do
  sketchybar --add item space.$sid left \
    --set space.$sid \
      icon="$sid" \
      icon.padding_left=8 \
      icon.padding_right=8 \
      label.drawing=off \
      background.corner_radius=4 \
      background.height=22 \
      drawing=off \
      click_script="aerospace workspace $sid" \
    --subscribe space.$sid aerospace_workspace_change
done

# 初期化スクリプト
sketchybar --add item workspace_init left \
  --set workspace_init \
    drawing=off \
    script="$PLUGIN_DIR/aerospace.sh" \
  --subscribe workspace_init aerospace_workspace_change

##### Left Items #####
sketchybar --add item separator left \
           --set separator icon="" label.drawing=off background.drawing=off \
           --add item front_app left \
           --set front_app \
             icon.drawing=off \
             background.drawing=off \
             script="$PLUGIN_DIR/front_app.sh" \
           --subscribe front_app front_app_switched

##### Right Items #####
sketchybar --add item clock right \
           --set clock \
             update_freq=10 \
             icon= \
             script="$PLUGIN_DIR/clock.sh" \
           --add item volume right \
           --set volume \
             icon.font="Hack Nerd Font:Bold:18.0" \
             script="$PLUGIN_DIR/volume.sh" \
           --subscribe volume volume_change \
           --add item battery right \
           --set battery \
             update_freq=120 \
             script="$PLUGIN_DIR/battery.sh" \
           --subscribe battery system_woke power_source_change

##### Force all scripts to run the first time #####
sketchybar --update
