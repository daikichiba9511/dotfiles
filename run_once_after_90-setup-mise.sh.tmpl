#!/bin/bash
set -eu

# mise completion
{{ if eq .chezmoi.os "darwin" }}
if [ -d /opt/homebrew/share/zsh/site-functions ]; then
  mise completion zsh > /opt/homebrew/share/zsh/site-functions/_mise 2>/dev/null || true
fi
{{ else if eq .chezmoi.os "linux" }}
mkdir -p ~/.local/share/zsh/site-functions
mise completion zsh > ~/.local/share/zsh/site-functions/_mise 2>/dev/null || true
{{ end }}

# install tools
mise trust -y
mise install -y

{{ if eq .chezmoi.os "linux" }}
# デフォルトshellをzshに (Ubuntu)
if [ "$(basename "$SHELL")" != "zsh" ] && command -v zsh &> /dev/null; then
  echo "==> Changing default shell to zsh..."
  sudo chsh -s "$(which zsh)" "${USER}" || true
fi
{{ end }}
